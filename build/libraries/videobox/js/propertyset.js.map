{"version":3,"sources":["js/propertyset.ts"],"names":[],"mappings":"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","file":"js/propertyset.js","sourcesContent":["/*!\t\r\n *\t@author\t\tHitkoDev http://hitko.eu/videobox\r\n *\t@copyright\tCopyright (C) 2016 HitkoDev All Rights Reserved.\r\n *\t@license\thttp://www.gnu.org/licenses/gpl-3.0.html GNU/GPL\r\n *\r\n *\tThis program is free software: you can redistribute it and/or modify\r\n *\tit under the terms of the GNU General Public License as published by\r\n *\tthe Free Software Foundation, either version 3 of the License, or\r\n *\tany later version.\r\n *\r\n *\tThis program is distributed in the hope that it will be useful,\r\n *\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\r\n *\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n *\tGNU General Public License for more details.\r\n *\r\n *\tYou should have received a copy of the GNU General Public License\r\n *\talong with this program. If not, see <http://www.gnu.org/licenses/>\r\n */\r\n\r\n/// <reference path=\"jquery.d.ts\" />\r\n\r\n(function($: JQueryStatic) {\r\n\r\n    // function to set the value of varoius input elements\r\n    function setVal(el: JQuery, value: any): void {\r\n        switch (el.attr(\"type\")) {\r\n            case \"radio\":\r\n            case \"checkbox\":\r\n                el.each(function() {\r\n                    if ($(this).attr('value') == value) {\r\n                        $(this).attr(\"checked\", 1);\r\n                    } else {\r\n                        $(this).removeAttr('checked');\r\n                    }\r\n                });\r\n                break;\r\n            case \"text\":\r\n            case \"hidden\":\r\n            default:\r\n                el.val(value);\r\n                break;\r\n        }\r\n    }\r\n\r\n    function getVal(form: JQuery, name: string): string {\r\n        var p = form.serializeArray();\r\n        for (var i = 0; i < p.length; i++) if (p[i].name == name) return p[i].value;\r\n        return '';\r\n    }\r\n\r\n    $(window).on('load', function(evt: JQueryEventObject) {\r\n\r\n        $('input.vb-prop-set').each(function(i: number, el: Element) {\r\n\r\n            var\r\n                form: JQuery = $(el).parents('form'),\r\n                key: string = $(el).attr('data-key'),\r\n                prefix: string = $(el).attr('data-prefix'),\r\n                values: any = $.parseJSON($(el).val()),\r\n                id: string = $(el).attr('id'),\r\n                item: JQuery = $('#' + id + '-list').find('*[data-set=\"' + key + '\"]'),\r\n                keyInput: JQuery = $('#' + id + '-key');\r\n\r\n            // bind listener for property set field\r\n            keyInput.on('change', function(evt: JQueryEventObject) {\r\n                var name = $(evt.target).attr('name');\r\n                if (name) {\r\n                    // get cleansed key value (dash-separated values)\r\n                    var value = getVal(form, name).replace(/(^\\W+)|(\\W+$)/g, '').replace(/\\W+/g, '-').toLowerCase();\r\n\r\n                    // return on invalid value\r\n                    if (!value || value == 'new') return false;\r\n\r\n                    // set cleansed value\r\n                    setVal($(evt.target), value);\r\n\r\n                    // update key if neccesary\r\n                    if (key != value) {\r\n                        values[value] = $.extend({}, values[key]);\r\n                        values[key] = undefined;\r\n                        key = value;\r\n                        values[key]['property_set'] = key;\r\n                        setVal($(el), JSON.stringify(values));\r\n                        item.attr('data-set', key);\r\n                        item.html(key);\r\n                    }\r\n                }\r\n            });\r\n\r\n            // bind remove event on property sets\r\n            $('#' + id + '-list').find('.icon-cancel').on('click', function(evt: JQueryEventObject) {\r\n                var itemKey = $(evt.target).parents('li').attr('data-set');\r\n\r\n                // remove set\r\n                values[itemKey] = undefined;\r\n                setVal($(el), JSON.stringify(values));\r\n\r\n                // save changes\r\n                window['Joomla'].submitbutton('plugin.apply');\r\n            });\r\n\r\n            // bind input listeners\r\n            var fields = [\r\n                'input',\r\n                'select',\r\n                'textarea'\r\n            ];\r\n            var qry = '';\r\n            for(var j = 0; j < fields.length; j++){\r\n                if(qry) qry += ', ';\r\n                qry += fields[j] + '[name^=\"' + prefix + '\"], ';\r\n                qry += fields[j] + '[name*=\" ' + prefix + '\"]';\r\n            }\r\n            form.find(qry).on('change select click', function(evt: JQueryEventObject) {\r\n                var name = $(evt.target).attr('name');\r\n                if (name) {\r\n                    var value = getVal(form, name);\r\n                    if (!values[key]['property_set']) values[key] = {\r\n                        'property_set': key\r\n                    };\r\n                    values[key][name] = value;\r\n                    setVal($(el), JSON.stringify(values));\r\n                }\r\n            });\r\n        });\r\n    });\r\n\r\n})(jQuery);"],"sourceRoot":"/source/"}